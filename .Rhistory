source("oemTest.R")
q()
library(mse)
library(FLa4a)
library(ggplotFL)
library(doParallel)
registerDoParallel(3)
mpargs$nblocks <- 3
resp3b0 <- mp(om, oem, ctrl.mp=ctrl, genArgs=mpargs)
all.equal(resp3b0, resp3b)
q()
library(devtools)
library(FLa4a)
library(ggplotFL)
library(doParallel)
load_all("../mse")
load("oemTest.RData")
ls()
registerDoParallel(3)
mpargs$nblocks <- 3
set.seed(1234)
noise.iem
mpargs$management_lag <- 2
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
om
oem
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
mpargs$management_lag <- 2
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
tracking
tracking
tracking["metric.is", ac((iy-genArgs$management_lag+1):(iy-1))]
catch(stk.om)[,ac((iy+1):(iy+genArgs$management_lag-2))]
(iy+1)
(iy+genArgs$management_lag-2)
(iy+genArgs$management_lag-1)
tracking["metric.is", ac((iy-genArgs$management_lag+1):(iy-1))] <- catch(stk.om)[,ac((iy+1):(iy+genArgs$management_lag-1))]
tracking
tracking["metric.is", ac((iy-genArgs$management_lag+1):(iy-1))] <- catch(stk.om)[,ac((iy+1):(iy+genArgs$management_lag-1))]
tracking
Q
load_all("../mse")
mpargs
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
load_all("../mse")
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
traceback()
load_all("../mse")
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
registerDoParallel(1)
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
load_all("../mse")
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
noise.iem <- function(ctrl, fun="rlnorm", mean=0, sd=0.1, multiplicative=TRUE, genArgs, tracking){
  # eh? number of non NA values in target. But if there are NAs then we need to
  # know their position for the *ctrl@trgtArray later
# use decision taken in year considering management lag
browser()
    ctrl@trgtArray[,"val",][] <- tracking["metric.is",ac(genArgs$ay-genArgs$management_lag+1)]
iem <- list(mean = mean, sd = sd, n = sum(!is.na(ctrl@trgtArray)))
if(multiplicative){
ctrl@trgtArray <- do.call(fun, iem) * ctrl@trgtArray
} else {
ctrl@trgtArray <- do.call(fun, iem) + ctrl@trgtArray
}
lst <- list(ctrl=ctrl, tracking=tracking)
lst
} # }}}
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl@trgtArray[,"val",][]
tracking["metric.is",ac(genArgs$ay-genArgs$management_lag+1)]
ctrl@trgtArray[,"val",][] <- tracking["metric.is",ac(genArgs$ay-genArgs$management_lag+1)]
ctrl@trgtArray
Q
catch(stock(om))
catch(stock(om))[,'2018']
catch(stock(om))[,'2018'] <- 50000
rm(noise.iem)
load_all("../mse")
load_all("../mse")
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
registerDoParallel(3)
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem2)
tracking(resp3biem2)
tracking(resp3biem2)[,,,,,1]
mpargs <- list(fy=fy, y0=y0, iy=iy, nsqy=nsqy)
mpargs$seed <- 1234
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
registerDoParallel(3)
mpargs$nblocks <- 3
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
registerDoParallel(1)
mpargs$nblocks <- 3
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
traceback()
registerDoParallel(1)
mpargs$nblocks <- 1
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
traceback()
sca.sa
load_all("../mse")
registerDoParallel(1)
mpargs$nblocks <- 1
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
registerDoParallel(1)
mpargs$nblocks <- 1
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl
ctrl$ctrl.est
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
traceback()
perfect.sa <- function(stk, idx, genArgs, tracking, ...) {
  tracking["convergence",ac(range(stk)["maxyear"] + 1)] <- 1
  list(stk=stk, tracking=tracking)
}
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
perfect.sa <- function(stk, idx, genArgs, tracking, ...) {
browser()
  tracking["convergence",ac(range(stk)["maxyear"] + 1)] <- 1
  list(stk=stk, tracking=tracking)
}
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ls()
genArgs
genArgs$ay
tracking()
tracking
Q
rm(perfect.sa)
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
registerDoParallel(1)
mpargs$nblocks <- 1
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
tracking
c
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
mpargs$management_lag <- 2
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
Q
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
tracking
Q
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
registerDoParallel(1)
mpargs$nblocks <- 1
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
tracking
Q
load_all("../mse")
registerDoParallel(1)
mpargs$nblocks <- 1
set.seed(1234)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
tracking
Q
mpargs$management_lag <-1
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
mpargs
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
traceback()
load_all("../mse")
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
tracking
iy-genArgs$management_lag+1
ac((iy-genArgs$management_lag+1):iy))
ac((iy-genArgs$management_lag+1):iy)
tracking["metric.is", ac((iy-genArgs$management_lag+1):iy)]
iy+genArgs$management_lag-1
ac((iy+1):(iy+genArgs$management_lag-1))
ac((iy+1):(iy+genArgs$management_lag))
tracking["metric.is", ac((iy-genArgs$management_lag+1):iy)] <- catch(stk.om)[,ac((iy+1):(iy+genArgs$management_lag))]
Q
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
load_all("../mse")
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
load_all("../mse")
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
traceback()
debug(goFish)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
load_all("../mse")
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ls()
load_all("../mse")
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
c
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
debug(goFish)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
n
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
debug(goFish)
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
method(ctrl.mp$ctrl.est)
fbar(stk0)[, ac(ay - 1)]
tracking["F.est", ac(ay)]
ctrl@trgtArray[ac(ay + 1), 
    "val", ]
do.call("mpDispatch", ctrl.is)
Q
load_all("../mse")
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=perfect.sa)))
resp3biem1 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem1)
mpargs$management_lag <- 2
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem2)
tracking(resp3biem2)
tracking(resp3biem1)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
registerDoParallel(3)
mpargs$nblocks <- 3
set.seed(1234)
mpargs$management_lag <- 1
resp3biem0 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem0)
mpargs$management_lag <- 2
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem2)
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
set.seed(1234)
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
mpargs$management_lag <-1
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
traceback()
load_all("../mse")
set.seed(1234)
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
debug(goFish)
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
debug(goFish)
registerDoParallel(1)
mpargs$nblocks <- 1
mpargs$nblocks <- 3
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl@trgtArray[ac(ay + 1), 
    "val", ]
ctrl@trgtArray[ac(genArgs$management_lag),"val",]
ctrl@trgtArray[ac(ay+genArgs$management_lag),"val",]
Q
q(
)
library(devtools)
load_all("../mse")
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
library(FLa4a)
library(doParallel)
library(ggplotFL)
registerDoParallel(1)
mpargs$nblocks <- 3
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
dim(stk)
dim(stk)[6]
load_all("../mse")
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem0b)
resp3biem0b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem0b)
load_all("../mse")
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
set.seed(1234)
resp3biem0 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
all.equal(resp3biem0, resp3biem0b)
plot(resp3biem0)
plot(resp3biem0b)
plot(resp3biem0)
plot(resp3biem0b)
load_all("../mse")
registerDoParallel(3)
mpargs$nblocks <- 3
set.seed(1234)
resp3biem1b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
set.seed(1234)
resp3biem1b <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem1b)
mpargs$management_lag <- 2
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
tracking(resp3biem1b)
load_all("../mse")
registerDoParallel(1)
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
load_all("../mse")
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
load_all("../mse")
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ls()
ctrl
n
ctrl
genArgs
ctrl@trgtArray[ac(ay+genArgs$management_lag),"val",]
ay
genArgs$management_lag
ctrl@trgtArray
Q
load_all("../mse")
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl <- mpCtrl(list(ctrl.hcr = mseCtrl(method=fixedF.hcr, args=list(ftrg=0.3)),
ctrl.is = mseCtrl(method=tac.is),
ctrl.est = mseCtrl(method=sca.sa)))
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ctrl
tracking
Q
iem <- FLiem(method=noise.iem, args=list(fun="rlnorm", mean=0, sd=0, multiplicative=TRUE))
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
tracking
ctrl
tracking["metric.is",ac(genArgs$ay-genArgs$management_lag+1)]
ctrl@trgtArray[,"year",][]
ctrl@trgtArray["year",,][]
ctrl
ctrl
ctrl@trgtArray[,"ay+1",]
ay+1
ctrl@trgtArray[,"auqntity",]
ctrl@trgtArray[,"quantity",]
ctrl@target[,"quantity",]
ac(ctrl@target[,"quantity",])
it
getCtrl(tracking["metric.iem",ac(genArgs$ay-genArgs$management_lag+1)], ac(ctrl@target[,"quantity",]), ay+1, it)
getCtrl(tracking["metric.is",ac(genArgs$ay-genArgs$management_lag+1)], ac(ctrl@target[,"quantity",]), ay+1, it)
getCtrl(tracking["metric.iem",ac(genArgs$ay-genArgs$management_lag+1)], ac(ctrl@target[,"quantity",]), ay+1, it)
ctrl <- getCtrl(tracking["metric.iem",ac(genArgs$ay-genArgs$management_lag+1)], ac(ctrl@target[,"quantity",]), ay+1, it)
Q
load_all("../mse")
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
ls(
)
tracking
n
stk.om <- do.call("mpDispatch", ctrl.om)$object
Q
load_all("../mse")
resp3biem2 <- mp(om, oem, iem, ctrl.mp=ctrl, genArgs=mpargs)
plot(resp3biem2)
Q()
q()
